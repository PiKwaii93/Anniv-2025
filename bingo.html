<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo de Soir√©e</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Bleu nuit pour l'ambiance soir√©e */
        }
        /* La grille reste 4x4, mais on assure une taille minimale des cellules pour le toucher */
        .bingo-grid {
            /* S'assurer que la grille utilise le mod√®le grid */
            display: grid; 
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 0.5rem; 
        }

        /* Style de base pour une cellule */
        .grid-cell {
            /* La hauteur est dict√©e par le contenu (texte) le plus long de la ligne Grid */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 0.75rem 0.5rem; /* Padding vertical et horizontal pour l'espace */
            min-height: 4rem; /* Assure une hauteur minimale pour le toucher sur mobile */
            
            line-height: 1.3; /* Ligne plus haute pour la lisibilit√© du texte long */
            word-break: break-word; /* Force les mots trop longs √† se couper pour √©viter le d√©bordement horizontal */
            
            border-radius: 0.75rem; /* rounded-xl */
            transition: all 0.2s ease-in-out;
            user-select: none;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            white-space: normal; /* S'assure que le texte passe √† la ligne */

            /* Le JS va d√©finir la taille de police dynamiquement ici */
        }
        
        /* Au-del√† de sm (tablet/desktop), on peut augmenter le padding et la hauteur minimale */
        @media (min-width: 640px) {
            .grid-cell {
                padding: 1rem;
                min-height: 6rem;
            }
        }

        /* Effet visuel au clic */
        .grid-cell:active {
            transform: scale(0.95);
        }

        /* Case non valid√©e */
        .not-validated {
            background-color: #374151; /* gray-700 */
            color: #d1d5db; /* gray-300 */
            border: 2px solid #4b5563; /* gray-600 */
        }

        /* Case valid√©e (Bingo) */
        .validated {
            background-color: #ef4444; /* red-500 */
            color: white;
            font-weight: bold;
            border: 2px solid #dc2626; /* red-600 */
            transform: scale(1.05); /* Effet d'accentuation */
        }
    </style>
</head>
<body class="text-white flex items-center justify-center min-h-screen p-2 md:p-4">
    
    <!-- Conteneur principal: max-w-full sur mobile et utilisation de 'mx-auto' pour centrer -->
    <div class="w-full max-w-4xl p-4 md:p-6 bg-slate-800 rounded-2xl shadow-2xl flex flex-col items-center space-y-4 md:space-y-6 border border-slate-700 min-h-[95vh] mx-auto">
        
        <div class="text-center w-full">
            <h1 class="text-3xl md:text-5xl font-bold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-red-500">
                üéâ Bingo de Soir√©e
            </h1>
            <p class="mt-2 text-sm md:text-lg text-slate-400 font-medium">
                Validez toutes les 16 cases pour gagner le Bingo Complet !
            </p>
        </div>

        <!-- Section Statut de Victoire -->
        <div id="winStatus" class="w-full text-center p-3 rounded-xl bg-green-900/50 border border-green-700 hidden">
            <p class="text-xl md:text-2xl font-bold text-green-300">
                ü•≥ BINGO COMPLET ! Vous avez gagn√© !
            </p>
        </div>

        <!-- Grille de Bingo -->
        <div id="bingoGrid" class="bingo-grid w-full flex-grow">
            <!-- Les cases seront g√©n√©r√©es ici par JavaScript -->
        </div>

        <!-- Boutons d'action -->
        <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto mt-auto">
            <button id="newGridBtn" 
                    class="w-full md:w-auto bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-150 transform hover:scale-105">
                Nouvelle Grille
            </button>
            <a href="index.html" 
               class="w-full md:w-auto bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-150 text-center flex items-center justify-center transform hover:scale-105">
                <span class="mr-2">üè†</span> Accueil
            </a>
        </div>
    </div>

    <script>
        // Constantes pour le jeu
        const GRID_SIZE = 4; // 4x4
        const TOTAL_SQUARES = GRID_SIZE * GRID_SIZE;
        const LOCAL_KEY = 'partyBingoGrid';
        
        // Taille maximale de la police pour √©viter un texte trop gros pour les courtes entr√©es
        const MAX_FONT_SIZE_PX = window.innerWidth < 640 ? 16 : 24; 
        // Taille minimale de la police pour la lisibilit√©
        const MIN_FONT_SIZE_PX = window.innerWidth < 640 ? 10 : 12; 

        // Actions de Bingo PERSONNALIS√âES (avec √©mojis ajout√©s)
        const bingoActions = [
            "Charlotte lance une chor√© üëØ‚Äç‚ôÄÔ∏è",
            "Thomas N / Sephora Octogone ü•ä",
            "Ma√´l s'asseoit et bouge plus pendant 1h üõãÔ∏è",
            "Alex lance des shots ü•É",
            "Talvyn lance un sujet de cul üçë",
            "Quelqu'un lance un Tu pr√©f√®res ü§î",
            "On a perdu quelqu'un üë§",
            "Lucie perd au beer pong üìâ",
            "Quelqu'un gratte un ticket √† gratter üé∞",
            "Cl√©ment twerk üíÉ",
            "Danse sexy d'Elena üî•",
            "Karaok√© Kongolese sous bbl üé§üêí",
            "Quelqu'un vomit ü§Æ",
            "Couple se galoche üíã",
            "Striptease / limousin ü§†",
            "Lorenzo masse quelqu'un üíÜ‚Äç‚ôÇÔ∏è",
            "Adam est aigri üò†",
            "Adam est plus aigri car il a vu une fille qui lui pla√Æt üòè",
            "Pam fais son geek Yu-Gi-Oh üëæ",
            "R√©mi giga chad face üòé",
            "Shacon perd au shifutizz üÉè",
            "Benji est pr√©sent ‚úÖ",
            "Albano accuse quelqu'un d'√™tre raciste üó£Ô∏è",
            "Maxence est accus√© de racisme üõë",
            "Maxence fait miaou miaou üòæ",
            "Quentin fume des substances üí®",
            "Florian cul sec ü•§",
            "Quelqu'un d'autre prend le coktail du chef üçπ",
            "Mathilde s'endort / rentr√© üò¥üö™",
            "Ta√Øs marche sur quelqu'un üë£",
            "Oriane / Lucie Octogone ü§º‚Äç‚ôÄÔ∏è",
            "Killer termin√© üî™",
            "Assassin termin√© üéØ",
            "Alex fait Blue Star sur just dance üï∫",
            "Maxence souffle ses bougies üéÇ",
            "Quelqu'un r√©ussi une double travers√©e du d√©sert üåµüåµ",
            "Cl√©ment se fait claquer le cul üëãüçë",
            "Maxence se fait claquer le cul üëãüçë",
            "Lorenzo fait une d√©claration d'amiti√© ü•∞",
            "Alison joue √† un jeu d'alcool üé≤",
            "Ethan RP Ekko ‚è≥",
            "Elio est raciste üò°",
            "In√®s sociabilise avec tout le monde üí¨",
            "Elena hurle ! üò±",
            "Session JDR üêâ",
            "Oriane √©crase quelqu'un avec des √©chasses ü¶µüí•",
            "Carrelage qui saute üí£",
            "Chaise cass√©e üî®",
            "Verre cass√© üç∏‚ùå",
            "Quelqu'un reverse un verre üíß",
            "Session confessionnal ü§´",
            "Spatule de la confession ü•Ñ",
            "Carla se tr√©mousse sur le dancefloor üé∂",
            "Thomas N boit de l'alcool üò±üç∑",
            "Mathis parle de LoL üéÆ",
            "Matthis fait son vieux üë¥",
            "Une contre soir√©e √† lieu üèòÔ∏è",
            "Joachim prend un Narnia üß•",
            "Lycia se fait draguer par une meuf üè≥Ô∏è‚Äçüåà",
            "√âlodie gagne au beer pong üèÜ",
            "Ma√´l parle politique üèõÔ∏è",
            "Camille H d√©couvre l'iceberg üßä",
            "Camille boit pour oublier üò¢üç∫",
            "Quelqu'un commande a manger üçï",
            "Edy natural 20 ‚ú®",
            "Arthur rage ü§¨",
            "Maxence aime pas ses cadeaux üéÅüëé",
            "Maxence aime ses cadeaux üéÅüëç",
            "Quelqu'un part faire un tour üö∂‚Äç‚ôÇÔ∏è",
            "Quelqu'un arrive 4+ heures en retard ‚è±Ô∏è",
            "Alexandra se plaint de l'√©cole üìö",
            "Hortense pr√©pare un coktail signature üç∏üëå",
            "R√©union dans la chambre de Maxence ü§´",
            "Toilettes a 2 ? üöª",
            "Lucie tape quelqu'un ü§õ",
            "Pam gagn√© au beer pong ü•á",
            "Alex se fait frapper ü§ï",
            "Maxence se fait agresser üò†",
            "R√©mi est trop beau üòç",
            "Alex est un sale tra√Ætre üêç",
            "Alex passe pour un raciste ü§¶‚Äç‚ôÇÔ∏è",
            "Talvyn sort une excuse ü§•",
            "Talvyn reste 30min devant la maison avant de rentrer üö™",
            "Corentin donne son avis sur un film üé¨",
            "Lorenzo fait son daron üë®‚Äçüëß",
            "Sephora fait sa bad bitch üíÖ",
            "L√©a bat quelqu'un √† une √©preuve physique üí™",
            "Fanny drague quelqu'un üòâ",
            "Pam parle de son mariage üíç",
            "Pam parle de son EVG ü§µ‚Äç‚ôÇÔ∏è",
            "Pam d√©couvre les secrets de l'EVJF ü§´üë∞‚Äç‚ôÄÔ∏è",
            "Fanny parle de son mariage üíç",
            "Fanny parle de son EVJF üë∞‚Äç‚ôÄÔ∏è",
            "Fanny d√©couvre les secrets de l'EVG ü§´ü§µ‚Äç‚ôÇÔ∏è",
            "Sephora chante mal üé∂üòÇ",
            "Un Disney passe üè∞",
            "Quelqu'un d√©chire un v√™tement üëö rip",
            "Elio vient bien habill√© üëî",
            "Quelqu'un vient en joggo üèÉ‚Äç‚ôÄÔ∏è",
            "Elio fait une tirade en japonais üáØüáµ",
            "Pyramide üî∫",
            "Travers√©e du d√©sert ü•Éüåµ",
            "Purple +12 üçá",
            "R√©mi se tr√©mousse sur Dualipa üï∫üéµ",
            "Sephora se tr√©mousse sur du Rihanna üíÉüéµ",
            "Elena est trop belle ‚ú®",
            "Quelqu'un explique les tr√©fonds le l'iceberg üßêüßä",
            "Quelqu'un rajoute un √©l√©ment a l'iceberg üìùüßä",
            "Charlotte cul sec üçª",
            "Charlotte joue une partie de beer pong üèì",
            "Mathilde danse un slow üïØÔ∏è",
            "Mathilde gagne √† un jeu d'alcool ü•Ç",
            "Ma√´l parle d'Halloween üéÉ",
            "Adam casse l√† d√©marche üö∂‚Äç‚ôÇÔ∏èüö∂‚Äç‚ôÇÔ∏è",
            "Albano casse l√† d√©marche üö∂‚Äç‚ôÇÔ∏èüö∂‚Äç‚ôÇÔ∏è",
            "Adam se fait v√©n√©rer üôè",
            "Albano & Adam session vannes üòÇ",
            "Cl√©ment F lance une comp√©tition de twerk üçëüèÜ",
            "Cl√©ment soul√®ve quelqu'un üèãÔ∏è‚Äç‚ôÇÔ∏è",
            "Chacon coktail signature üçπ",
            "Arthur double cul sec ü•Éü•É",
            "Maxence frappe Sephora üëä",
            "Maxence fait le jeu de la ceinture √† quelqu'un üëå",
            "Charlotte prends 3 shots dans la soir√©e üçπüçπüçπ",
            "Charlotte se pr√©sente en tant que falucharde üéì",
            "Elena RP r√©ception h√¥tel üõéÔ∏è",
            "Sephora maquille quelqu'un üíÑ",
            "Adam fait une de d√©claration de guerre √† Disney ‚öîÔ∏èüê≠",
            "Albano atomise quelqu'un au beer pong üí£üèì",
            "Quelqu'un joue √† LoL üíª",
            "Elio raconte son anecdotes iceberg üìñüßä",
            "Sephora raconte son anecdotes iceberg üìñüßä",
            "quelqu'un perd a la travers√© du d√©sert üò≠üåµ",
            "Alex crie les sons d'√©t√© ‚òÄÔ∏èüîä",
            "Alexandra gagne contre quelqu'un de LS ü•á",
            "Alison cul sec üçª",
            "Baptiste perds au beer pong ü•∫üèì",
            "Baptiste reste avec sa copine üë©‚Äç‚ù§Ô∏è‚Äçüë®",
            "Benji se fait maquiller üé®",
            "Benji rattrape le temps perdu (tout les sens du terme) ‚è≥üòÖ",
            "Benji cul sec üçª",
            "Camille apprend l'iceberg ü§ìüßä",
            "Edy apprend l'iceberg ü§ìüßä",
            "Camille H rattrape le temps perdu üèÉ‚Äç‚ôÄÔ∏èüí®",
            "Faites en sorte que carla fasse partie du groupe soir√©e üçªüëØ‚Äç‚ôÄÔ∏è",
            "Faites en sortes que In√®s fasse partie du groupe soir√©e üçªüëØ‚Äç‚ôÄÔ∏è",
            "Elena sauve quelqu'un üöë",
            "Elena verse de l'alcool dans la bouche de quelqu'un üëÑü•Ç",
            "Rappeler a Ethan que c'est un jeunot üë∂",
            "Quelqu'un se plaint de la musique üîá" 
        ];

        // R√©f√©rences DOM
        const bingoGrid = document.getElementById('bingoGrid');
        const newGridBtn = document.getElementById('newGridBtn');
        const winStatus = document.getElementById('winStatus');


        // --- Fonctions d'Utilit√© ---

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function saveGridState(state) {
            try {
                // IMPORTANT: Utilisation de localStorage, car les environnements sans base de donn√©es
                // ne supportent pas de stockage persistant plus complexe.
                localStorage.setItem(LOCAL_KEY, JSON.stringify(state));
            } catch (error) {
                console.error("Erreur lors de la sauvegarde de l'√©tat :", error);
            }
        }

        function loadGridState() {
            try {
                const stored = localStorage.getItem(LOCAL_KEY);
                return stored ? JSON.parse(stored) : null;
            } catch (error) {
                console.error("Erreur lors du chargement de l'√©tat :", error);
                return null;
            }
        }

        /**
         * Calcule la taille de police maximale pour qu'un texte tienne dans sa cellule,
         * en utilisant la hauteur d√©j√† d√©finie par le Grid Layout (qui garantit l'alignement des lignes).
         * @param {string} text Le texte √† ins√©rer.
         * @param {HTMLElement} element L'√©l√©ment DOM de la cellule.
         * @returns {number} La taille de police en pixels.
         */
        function calculateFontSize(text, element) {
            // Cloner l'√©l√©ment pour mesurer sans affecter le layout original
            const clone = element.cloneNode(true);
            clone.textContent = text;
            
            // Appliquer les styles de positionnement pour que le clone ne perturbe pas le DOM visible
            clone.style.fontSize = `${MAX_FONT_SIZE_PX}px`;
            
            // CRITIQUE : Utiliser la largeur et la hauteur r√©elles de l'√©l√©ment parent.
            // On s'assure que le clone prend la m√™me taille que sa destination.
            clone.style.width = element.offsetWidth + 'px'; 
            clone.style.height = element.offsetHeight + 'px';
            
            clone.style.position = 'absolute';
            clone.style.top = '-9999px'; // Le placer loin de la vue
            clone.style.visibility = 'hidden';
            
            document.body.appendChild(clone);

            let fontSize = MAX_FONT_SIZE_PX;
            
            // La hauteur cible est la hauteur de la case r√©elle moins le padding et une petite marge de s√©curit√© (4px)
            const computedStyle = getComputedStyle(element);
            const paddingTop = parseFloat(computedStyle.paddingTop);
            const paddingBottom = parseFloat(computedStyle.paddingBottom);
            const targetHeight = element.offsetHeight - (paddingTop + paddingBottom) - 4; 
            
            // Boucle pour r√©duire la taille de police tant que le contenu d√©borde de la hauteur de la case
            // Note: Nous utilisons offsetHeight du clone qui est initialement fix√© √† element.offsetHeight
            while (clone.scrollHeight > targetHeight && fontSize > MIN_FONT_SIZE_PX) {
                fontSize -= 0.5;
                clone.style.fontSize = `${fontSize}px`;
            }

            document.body.removeChild(clone);

            // Retourne la taille calcul√©e, sans jamais √™tre inf√©rieure √† la taille minimale
            return Math.max(fontSize, MIN_FONT_SIZE_PX);
        }


        // --- Logique du Jeu ---

        function checkWin(gridState) {
            if (!gridState || gridState.length !== TOTAL_SQUARES) {
                showWinStatus(false);
                return false;
            }

            // V√©rifie si TOUTES les cases sont valid√©es (Bingo Complet)
            const allValidated = gridState.every(cell => cell.validated);

            if (allValidated) {
                showWinStatus(true);
                return true;
            }
            
            showWinStatus(false);
            return false;
        }

        function showWinStatus(isWon) {
            if (isWon) {
                winStatus.classList.remove('hidden');
                // D√©sactive la grille apr√®s la victoire
                bingoGrid.classList.add('pointer-events-none', 'opacity-50');
            } else {
                winStatus.classList.add('hidden');
                // Assure que la grille est active si on n'a pas gagn√©
                bingoGrid.classList.remove('pointer-events-none', 'opacity-50');
            }
        }


        // --- Rendu et Initialisation ---
        
        // Ceci est la fonction principale de rendu qui utilise l'ajustement dynamique de la police
        function renderGrid(gridState) {
            bingoGrid.innerHTML = '';
            
            // 1. G√©n√©rer et ins√©rer les √©l√©ments (pour que le Grid Layout d√©finisse les hauteurs de ligne)
            gridState.forEach((cell, index) => {
                const cellDiv = document.createElement('div');
                let baseClasses = 'grid-cell font-semibold transition duration-200 shadow-lg border-2 hover:scale-[1.02]';
                
                cellDiv.className = `${baseClasses} ${cell.validated ? 'validated' : 'not-validated'}`;
                cellDiv.textContent = cell.text;
                cellDiv.dataset.index = index;
                bingoGrid.appendChild(cellDiv);
            });

            // 2. Ajuster la taille de la police pour chaque cellule
            // Utiliser requestAnimationFrame pour garantir que le navigateur a termin√© le layout (hauteurs de lignes)
            requestAnimationFrame(() => {
                const cells = bingoGrid.querySelectorAll('.grid-cell');
                
                cells.forEach(cell => {
                    const text = cell.textContent;
                    // Calcule la taille de police pour que le texte tienne dans la hauteur et la largeur de la cellule
                    const bestSize = calculateFontSize(text, cell); 
                    cell.style.fontSize = `${bestSize}px`;
                });
            }); 
        }

        function newGame() {
            const shuffledActions = shuffle([...bingoActions]);
            // S'assurer qu'on a assez d'actions pour la grille 4x4 (16 actions)
            const selectedActions = shuffledActions.slice(0, TOTAL_SQUARES); 
            if (selectedActions.length < TOTAL_SQUARES) {
                console.error("Pas assez d'actions pour remplir la grille. Veuillez en ajouter plus.");
                alert("Erreur: Pas assez d'actions de Bingo disponibles. Une grille 4x4 requiert 16 actions.");
                return;
            }

            const newGridState = selectedActions.map(action => ({
                text: action,
                validated: false
            }));

            renderGrid(newGridState);
            saveGridState(newGridState);
            checkWin(newGridState); 
        }

        function handleGridClick(event) {
            const cellElement = event.target.closest('div');
            // V√©rifie si le clic provient bien d'une cellule de la grille et si la grille n'est pas d√©sactiv√©e
            if (!cellElement || !cellElement.dataset.index || bingoGrid.classList.contains('pointer-events-none')) return;

            const index = parseInt(cellElement.dataset.index, 10);
            let gridState = loadGridState();
            if (!gridState || index >= gridState.length) return;

            gridState[index].validated = !gridState[index].validated;

            // On met √† jour l'√©tat et on re-rend toute la grille, ce qui recalcule les polices au besoin
            renderGrid(gridState);
            saveGridState(gridState);
            checkWin(gridState);
        }

        // --- √âv√©nements ---
        newGridBtn.addEventListener('click', newGame);
        bingoGrid.addEventListener('click', handleGridClick);

        window.onload = function() {
            // Ajout d'un √©couteur d'√©v√©nement pour recalculer les polices lors du redimensionnement
            // Cela g√®re les changements d'orientation mobile ou le redimensionnement du navigateur
            window.addEventListener('resize', () => {
                const storedState = loadGridState();
                if (storedState) {
                    renderGrid(storedState); 
                }
            });

            const storedState = loadGridState();
            if (storedState) {
                // Si un √©tat est stock√©, on le rend et on v√©rifie l'√©tat de la victoire
                renderGrid(storedState);
                checkWin(storedState);
            } else {
                // Sinon, on lance une nouvelle partie
                newGame();
            }
        }
    </script>
</body>
</html>
