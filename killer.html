<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu du Killer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Bleu fonc√© pour un th√®me de soir√©e */
        }
        .reveal-role {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .rule-card {
            @apply bg-slate-700 p-6 rounded-xl border border-slate-600 shadow-lg;
        }
    </style>
</head>
<body class="bg-slate-900 text-white flex flex-col items-center justify-center min-h-screen p-4">
    <div class="container mx-auto max-w-2xl p-6 bg-slate-800 rounded-3xl shadow-2xl flex flex-col items-center space-y-8">
        
        <header class="text-center w-full">
            <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight text-transparent bg-clip-text" style="background-image: linear-gradient(45deg, #f87171, #ef4444);">
                Jeu du Killer üî™
            </h1>
            <p class="mt-2 text-slate-400">Attribution des r√¥les et r√®gles du jeu.</p>
        </header>

        <!-- Zone d'affichage des r√®gles -->
        <section id="rulesSection" class="w-full space-y-4">
            <button id="toggleRulesBtn" class="w-full py-2 px-4 bg-slate-700 hover:bg-slate-600 text-white font-bold rounded-lg transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                Afficher les R√®gles du Jeu
            </button>
            
            <div id="rulesContent" class="rule-card hidden space-y-6">
                <h2 class="text-2xl font-bold text-red-400 border-b border-slate-600 pb-2">R√®glement Complet</h2>

                <!-- R√¥les -->
                <div>
                    <p class="text-xl font-bold text-red-500 mb-1">üî™ Le Tueur (Killer)</p>
                    <p class="text-sm text-slate-300 ml-4">
                        Objectif : <strong>√âliminer tous les Citoyens</strong>. Pour "tuer", vous devez **cr√©er un contact visuel puis effectuer un clin d'≈ìil** √† votre victime.
                    </p>
                </div>
                <div>
                    <p class="text-xl font-bold text-blue-500 mb-1">üïµÔ∏è L'Enqu√™teur</p>
                    <p class="text-sm text-slate-300 ml-4">
                        Objectif : <strong>Identifier le Tueur</strong>. Accusez √† haute voix. Si vous avez raison, vous gagnez. Si vous vous trompez, vous √™tes √©limin√©.
                    </p>
                </div>
                <div>
                    <p class="text-xl font-bold text-green-500 mb-1">üßç Le Citoyen</p>
                    <p class="text-sm text-slate-300 ml-4">
                        Objectif : Survivre. Si vous recevez un clin d'≈ìil, attendez quelques secondes, puis <strong>exag√©rez votre mort</strong> de mani√®re visible pour informer les autres joueurs.
                    </p>
                </div>

                <h3 class="text-xl font-bold mt-4 text-yellow-400">Conditions de Victoire</h3>
                <ul class="list-disc list-inside space-y-1 text-sm text-slate-300 ml-4">
                    <li>Le Tueur gagne si tous les Citoyens sont √©limin√©s.</li>
                    <li>L'Enqu√™teur (et les Citoyens) gagnent si le Tueur est d√©masqu√©.</li>
                </ul>
            </div>
        </section>
        
        <!-- Section Ajout des Joueurs -->
        <section class="w-full space-y-4 pt-4 border-t border-slate-700">
            <h2 class="text-2xl font-bold text-center text-white">1. Joueurs</h2>
            <div class="flex space-x-2">
                <input type="text" id="playerNameInput" placeholder="Nom du joueur..." class="flex-grow p-3 bg-slate-700 text-white rounded-lg border border-slate-600 focus:ring-2 focus:ring-red-500 focus:border-red-500">
                <button id="addPlayerBtn" class="px-5 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition duration-200 shadow-md transform hover:scale-[1.02]">
                    +
                </button>
            </div>
            
            <ul id="playersList" class="space-y-2 max-h-48 overflow-y-auto pr-2">
                <!-- Les joueurs seront ins√©r√©s ici -->
            </ul>
        </section>
        
        <!-- Boutons de Contr√¥le -->
        <section class="w-full flex space-x-4 pt-4 border-t border-slate-700">
            <button id="startGameBtn" class="flex-grow py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-xl transition duration-200 shadow-lg transform hover:scale-[1.02] disabled:opacity-50" disabled>
                Attribuer les R√¥les (Min. 3)
            </button>
            <button id="resetGameBtn" class="w-1/4 py-3 bg-slate-600 hover:bg-slate-700 text-white font-bold rounded-xl transition duration-200 shadow-lg transform hover:scale-[1.02]">
                Reset
            </button>
        </section>
        
    </div>

    <!-- Modale d'Affichage de R√¥le -->
    <div id="roleModal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-slate-700 p-8 rounded-2xl shadow-2xl text-center reveal-role max-w-sm w-full">
            <p class="text-slate-400 text-lg mb-4">Ton r√¥le est :</p>
            <h2 id="currentRoleDisplay" class="text-5xl font-extrabold mb-6 text-red-400">R√îLE</h2>
            <button id="hideRoleBtn" class="py-2 px-6 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition duration-200">
                Masquer (Passe au joueur suivant)
            </button>
        </div>
    </div>

    <!-- Script JS -->
    <script>
        // Constantes et Variables Globales
        const ROLES = ['Tueur', 'Enqu√™teur', 'Citoyen'];
        const LOCAL_STORAGE_KEY = 'killerGame';
        let players = [];
        let rolesAssigned = false;
        let nextPlayerIndex = 0;

        // √âl√©ments du DOM
        const playerNameInput = document.getElementById('playerNameInput');
        const addPlayerBtn = document.getElementById('addPlayerBtn');
        const playersList = document.getElementById('playersList');
        const startGameBtn = document.getElementById('startGameBtn');
        const resetGameBtn = document.getElementById('resetGameBtn');
        const roleModal = document.getElementById('roleModal');
        const currentRoleDisplay = document.getElementById('currentRoleDisplay');
        const hideRoleBtn = document.getElementById('hideRoleBtn');
        const rulesContent = document.getElementById('rulesContent');
        const toggleRulesBtn = document.getElementById('toggleRulesBtn');

        // --- Fonctions de Stockage ---
        function saveGameState() {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify({ players, rolesAssigned }));
        }

        function loadGameState() {
            const stored = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (stored) {
                const state = JSON.parse(stored);
                players = state.players || [];
                rolesAssigned = state.rolesAssigned || false;
            }
        }

        // --- Fonctions de Rendu ---
        function updateStartButton() {
            startGameBtn.disabled = players.length < 3;
            if (rolesAssigned) {
                startGameBtn.textContent = 'Voir les R√¥les attribu√©s';
            } else {
                startGameBtn.textContent = `Attribuer les R√¥les (Min. 3)`;
            }
        }

        function renderPlayers() {
            playersList.innerHTML = '';
            players.forEach((player, index) => {
                const li = document.createElement('li');
                li.className = 'flex items-center justify-between p-2 bg-slate-700/50 rounded-lg';
                
                // Nom du joueur
                const nameSpan = document.createElement('span');
                nameSpan.textContent = player.name;
                nameSpan.className = 'text-lg';
                
                // R√¥le affich√© apr√®s attribution (si la partie est lanc√©e)
                if (rolesAssigned && player.role) {
                    const roleSpan = document.createElement('span');
                    roleSpan.textContent = ` (${player.role})`;
                    roleSpan.className = 'font-bold ml-2 text-yellow-400';
                    nameSpan.appendChild(roleSpan);
                }

                li.appendChild(nameSpan);

                // Bouton Supprimer
                const deleteBtn = document.createElement('button');
                deleteBtn.innerHTML = '‚úï';
                deleteBtn.className = 'text-red-400 hover:text-red-500 transition';
                deleteBtn.onclick = () => removePlayer(index);
                
                li.appendChild(deleteBtn);
                playersList.appendChild(li);
            });
            updateStartButton();
            saveGameState();
        }

        // --- Logique du Jeu ---

        function addPlayer() {
            const name = playerNameInput.value.trim();
            if (name && players.length < 20) { // Limite arbitraire
                players.push({ name: name, role: null });
                playerNameInput.value = '';
                renderPlayers();
            }
        }

        function removePlayer(index) {
            players.splice(index, 1);
            rolesAssigned = false; // R√©initialiser si un joueur est retir√©
            renderPlayers();
        }
        
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function assignRoles() {
            if (players.length < 3) return;

            // D√©terminer les r√¥les : 1 Tueur, 1 Enqu√™teur, le reste Citoyens
            let roles = ['Tueur', 'Enqu√™teur'];
            const numCitizens = players.length - 2;
            for (let i = 0; i < numCitizens; i++) {
                roles.push('Citoyen');
            }
            
            // M√©langer les r√¥les
            roles = shuffle(roles);

            // Attribuer les r√¥les aux joueurs
            players.forEach((player, index) => {
                player.role = roles[index];
            });

            rolesAssigned = true;
            nextPlayerIndex = 0; // Commencer la distribution
            startGameBtn.textContent = 'D√©marrer la lecture des r√¥les';
            saveGameState();
            
            // Afficher le premier r√¥le
            showNextRole();
        }
        
        function showNextRole() {
            if (nextPlayerIndex < players.length) {
                const player = players[nextPlayerIndex];
                currentRoleDisplay.textContent = player.role;
                currentRoleDisplay.className = `text-5xl font-extrabold mb-6 reveal-role ${getRoleColor(player.role)}`;
                roleModal.querySelector('p').textContent = `C'est le tour de ${player.name} :`;
                roleModal.classList.remove('hidden');
                nextPlayerIndex++;
            } else {
                // Tous les r√¥les ont √©t√© distribu√©s
                roleModal.classList.add('hidden');
                startGameBtn.textContent = 'R√¥les attribu√©s. D√©marrer le jeu !';
                renderPlayers(); // Afficher les r√¥les de mani√®re permanente si l'attribution est termin√©e
            }
        }

        function getRoleColor(role) {
            switch(role) {
                case 'Tueur': return 'text-red-400';
                case 'Enqu√™teur': return 'text-blue-400';
                case 'Citoyen': return 'text-green-400';
                default: return 'text-white';
            }
        }

        // --- Gestion des √âv√©nements ---

        function handleGameStart() {
            if (rolesAssigned) {
                // Si les r√¥les sont d√©j√† attribu√©s, relancer la lecture (ou r√©v√©ler)
                renderPlayers();
                startGameBtn.classList.add('hidden');
                resetGameBtn.textContent = 'Nouvelle partie';
            } else {
                assignRoles();
            }
        }

        // √âv√©nements
        addPlayerBtn.addEventListener('click', addPlayer);
        playerNameInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                addPlayer();
            }
        });
        startGameBtn.addEventListener('click', handleGameStart);
        resetGameBtn.addEventListener('click', () => {
            localStorage.removeItem(LOCAL_STORAGE_KEY);
            window.location.reload();
        });
        
        hideRoleBtn.addEventListener('click', showNextRole);

        // Toggle des r√®gles
        toggleRulesBtn.addEventListener('click', () => {
            const isHidden = rulesContent.classList.toggle('hidden');
            toggleRulesBtn.textContent = isHidden ? 'Afficher les R√®gles du Jeu' : 'Masquer les R√®gles du Jeu';
        });

        // Initialisation
        window.onload = function() {
            loadGameState();
            renderPlayers();
            // Assurer que le bouton de d√©marrage refl√®te l'√©tat actuel
            updateStartButton();
        };
    </script>
</body>
</html>
