<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu de l'Assassin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Bleu fonc√© pour un th√®me de soir√©e */
        }
        .reveal-role {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .mission-completed-btn {
            background-color: #22c55e;
        }
        /* Style inspir√© du killer.html pour les r√®gles */
        .rule-card {
            background-color: #334155; /* bg-slate-700 */
            padding: 1.5rem;
            border-radius: 0.75rem; /* rounded-xl */
            border: 1px solid #475569; /* border-slate-600 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); /* shadow-lg */
        }
    </style>
</head>
<body class="bg-slate-900 text-white flex flex-col items-center justify-center min-h-screen p-4">
    <div class="container mx-auto max-w-2xl p-6 bg-slate-800 rounded-3xl shadow-2xl flex flex-col items-center space-y-8">
        <div class="text-center">
            <h1 class="text-5xl md:text-6xl font-bold tracking-tight text-white mb-2">Jeu de l'Assassin</h1>
            <p class="text-gray-400 text-lg">Distribuez les missions et √©liminez votre cible !</p>
        </div>

        <section id="rulesSection" class="w-full space-y-4">
            <button id="toggleRulesBtn" class="w-full py-2 px-4 bg-slate-700 hover:bg-slate-600 text-white font-bold rounded-lg transition duration-200 focus:outline-none focus:ring-2 focus:ring-purple-500">
                Afficher les R√®gles du Jeu
            </button>
            
            <div id="rulesContent" class="rule-card hidden space-y-4">
                <h2 class="text-2xl font-bold text-purple-400 border-b border-slate-600 pb-2">R√®glement Complet</h2>

                <div>
                    <p class="text-xl font-bold text-red-400 mb-1">üéØ Cible et Mission</p>
                    <p class="text-sm text-slate-300 ml-4">
                        Chaque joueur re√ßoit une **cible** (un autre joueur) et une **mission** secr√®te √† accomplir aupr√®s de cette cible.
                    </p>
                </div>
                <div>
                    <p class="text-xl font-bold text-green-400 mb-1">üî™ √âlimination</p>
                    <p class="text-sm text-slate-300 ml-4">
                        Pour **√©liminer** votre cible, vous devez r√©ussir la mission qui vous a √©t√© attribu√©e (ex: "Faire un compliment √† votre cible."). Une fois r√©ussie, vous appuyez sur **"Mission accomplie"**.
                    </p>
                </div>
                <div>
                    <p class="text-xl font-bold text-blue-400 mb-1">üîÑ Succession</p>
                    <p class="text-sm text-slate-300 ml-4">
                        Lorsque vous √©liminez votre cible, vous **prenez automatiquement la cible et la mission de votre victime**.
                    </p>
                </div>

                <h3 class="text-xl font-bold mt-4 text-yellow-400">Condition de Victoire</h3>
                <p class="text-sm text-slate-300 ml-4">
                    Le joueur gagne s'il est le **dernier assassin en vie** (tous les autres joueurs ont √©t√© √©limin√©s).
                </p>
            </div>
        </section>
        <div id="add-players-section" class="w-full space-y-4">
            <h2 class="text-2xl font-bold text-center">Ajouter les joueurs</h2>
            <div class="flex flex-col md:flex-row gap-4">
                <input type="text" id="player-name-input" placeholder="Nom du joueur" class="flex-grow p-3 rounded-lg bg-slate-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 transition-all">
                <button id="add-player-btn" class="bg-green-600 hover:bg-green-700 transition-all text-white font-bold py-3 px-6 rounded-xl shadow-lg transform hover:scale-105">
                    Ajouter
                </button>
            </div>
            <div id="error-message" class="text-red-400 text-center hidden">Veuillez entrer un nom valide.</div>
        </div>

        <div id="game-section" class="w-full space-y-6 hidden">
            <h2 class="text-2xl font-bold text-center">Joueurs</h2>
            <ul id="players-list" class="space-y-2 text-center text-lg"></ul>
            <div class="flex flex-col md:flex-row justify-center gap-4">
                <button id="start-game-btn" class="bg-purple-600 hover:bg-purple-700 transition-all text-white font-bold py-3 px-6 rounded-xl shadow-lg transform hover:scale-105">
                    Commencer la partie
                </button>
                <button id="reset-game-btn" class="bg-gray-600 hover:bg-gray-700 transition-all text-white font-bold py-3 px-6 rounded-xl shadow-lg transform hover:scale-105">
                    R√©initialiser
                </button>
            </div>
        </div>

        <div id="mission-modal" class="fixed inset-0 bg-slate-900 bg-opacity-95 flex items-center justify-center hidden p-4 reveal-role z-50">
            <div class="bg-slate-800 p-8 rounded-2xl shadow-2xl text-center max-w-lg w-full space-y-6">
                <h2 class="text-4xl font-bold">Votre Mission</h2>
                <div class="flex flex-col space-y-4">
                    <p class="text-lg text-gray-400">Votre cible est :</p>
                    <p id="player-target" class="text-5xl font-black text-red-500"></p>
                    <p class="text-lg text-gray-400">Votre mission est de :</p>
                    <p id="player-mission" class="text-2xl font-semibold text-white"></p>
                </div>
                <div class="flex flex-col md:flex-row justify-center gap-4 mt-6">
                    <button id="hide-mission-btn" class="bg-gray-600 hover:bg-gray-700 transition-all text-white font-bold py-3 px-6 rounded-xl shadow-lg transform hover:scale-105">
                        Cacher
                    </button>
                    <button id="complete-mission-btn" class="mission-completed-btn hover:bg-green-700 transition-all text-white font-bold py-3 px-6 rounded-xl shadow-lg transform hover:scale-105">
                        Mission accomplie !
                    </button>
                </div>
            </div>
        </div>
        
        <div id="win-modal" class="fixed inset-0 bg-slate-900 bg-opacity-95 flex items-center justify-center hidden p-4 reveal-role z-50">
            <div class="bg-slate-800 p-8 rounded-2xl shadow-2xl text-center max-w-sm w-full space-y-6">
                <h2 class="text-4xl font-bold text-green-500">VICTOIRE !</h2>
                <p id="winner-name" class="text-6xl font-black text-white"></p>
                <p class="text-lg text-gray-400">est le dernier assassin en vie !</p>
                <button id="new-game-btn" class="bg-blue-600 hover:bg-blue-700 transition-all text-white font-bold py-3 px-6 rounded-xl shadow-lg transform hover:scale-105">
                    Nouvelle partie
                </button>
            </div>
        </div>
    </div>
    <footer class="mt-16 text-center text-sm text-pink-400 font-medium">
        <a href="index.html" class="mt-10 px-8 py-3 bg-pink-600 hover:bg-pink-700 text-white font-bold rounded-full transition duration-300 shadow-lg shadow-pink-500/50 inline-flex items-center justify-center">
            <span class="mr-2">üè†</span> Retour √† l'Accueil des Jeux
        </a>
    </footer>

    <script>
        // Liste des missions pour le jeu (Mises √† jour avec emojis)
        const missions = [
            "üíã Obtenir un baiser sur la joue de ta cible (consenti).",
            "ü§´ Lui faire murmurer √† l‚Äôoreille ‚ÄúTu es irr√©sistible‚Äù.",
            "üëí L‚Äôamener √† porter un accessoire ridicule pendant 10 minutes (avec son accord).",
            "üì± Lui faire avouer la derni√®re personne qui lui a envoy√© un DM g√™nant.",
            "üëë L‚Äôamener √† t‚Äôappeler ‚Äúchef‚Äù pendant 1min.",
            "üëï Obtenir d‚Äôelle qu‚Äôelle √©change un v√™tement (√©charpe, bonnet) avec toi.",
            "üé§ La faire chanter pendant 10s.",
            "ü´Ç La pousser √† demander un c√¢lin collectif en public.",
            "‚úçÔ∏è Lui faire promettre (par √©crit) de faire quelque chose que tu veux.",
            "üó£Ô∏è Lui faire faire un mini-discours en mode ‚Äúje suis coupable‚Äù.",
            "ü§™ Obtenir une photo d‚Äôelle en faisant une grimace.",
            "üíò L‚Äôamener √† donner son meilleur conseil de s√©duction.",
            "ü•Ç La convaincre d‚Äô√©changer son verre contre un autre (et tenir la conversation).",
            "üé≠ La faire imiter une c√©l√©brit√©.",
            "üë∂ Lui faire confier le surnom le plus ridicule qu‚Äôon lui a donn√©.",
            "ü§≥ Obtenir un selfie.",
            "üìµ La convaincre de l√¢cher son smartphone 5 minutes et de le confier √† toi.",
            "üíî Lui faire mimer une rupture dramatique (avec toi comme complice).",
            "üì∏ Lui faire poser pour une fausse couverture de magazine.",
            "üè∑Ô∏è Lui faire promettre de porter un surnom choisi par toi une heure.",
            "üíñ Obtenir un √©change de compliments exag√©r√©s (style soap opera).",
            "üìù L‚Äôamener √† signer un ‚Äúcontrat‚Äù ridicule (post-it) pour faire une t√¢che absurde.",
            "ü§ê Lui faire prononcer son secret le moins g√™nant (choisi par elle).",
            "üíÉ Lui faire demander √† quelqu‚Äôun de danser.",
            "ü§¶‚Äç‚ôÄÔ∏è Lui faire raconter la pire excuse qu‚Äôelle a utilis√©e pour annuler un rencard.",
            "üëó Lui faire faire un compliment exag√©r√© sur sa tenue (genre soap).",
            "‚åö Lui faire pr√™ter un objet perso (bandeau, montre) pour une minute.",
            "üëÉ Lui faire deviner le parfum d‚Äôune personne les yeux ferm√©s.",
            "ü§£ Lui faire promettre de ne pas rire pendant 1 minute (et l‚Äôobliger √† essayer).",
            "ü•∞ Lui faire avouer son petit crush (si elle est ok √† en parler).",
            "‚ù§Ô∏è Lui faire dessiner un c≈ìur sur son bras.",
            "ü§´ Lui faire promettre de garder un secret anodin pendant la soir√©e.",
            "üì¢ Lui faire scander une phrase ridicule.",
            "ü§≥ Lui faire pr√™ter son t√©l√©phone pour un faux selfie ultra ghetto.",
            "üåü Lui faire inventer un compliment hyper-sp√©ciaux sur quelqu‚Äôun d‚Äôautre.",
            "üö∂‚Äç‚ôÄÔ∏è Lui faire marcher comme un mannequin sur 5 pas.",
            "üé§ Lui faire faire un mini-spectacle de 20s (chant, danse ou po√©sie).",
            "üå∂Ô∏è Lui faire √©crire une phrase coquine sur un post-it et la montrer (non explicite).",
            "üé∂ Lui faire chanter le refrain d‚Äôune chanson honteuse.",
            "ü©π Lui faire accepter de porter un pansement sur le front (pour la honte).",
            "ü§Ø Lui faire d√©crire sa pire drague ou pire RDV.",
            "‚öîÔ∏è Lui faire lancer un d√©fi √† quelqu‚Äôun d‚Äôautre.",
            "üëë Lui faire faire une r√©v√©rence exag√©r√©e devant une personne choisie.",
            "ü§° Lui faire imiter la fa√ßon de parler d‚Äôun invit√© pendant 10s.",
            "üì∑ Lui faire demander un selfie √† un inconnu.",
            "üíç Lui faire simuler une demande en mariage parodique (avec toi complice).",
            "üï∫ Lui faire danser comme si elle √©tait sur sc√®ne pendant 10s.",
            "üí™ Lui faire faire 10 pompes (ou un geste sportif).",
            "üí£ Lui faire accepter d‚Äô√™tre photobomb√©e volontairement pour 3 photos.",
            "üí° Lui faire inventer un surnom pour la derni√®re personne qui est entr√©e dans la pi√®ce.",
            "ü§© Lui faire annoncer qu‚Äôelle sera la star de la prochaine soir√©e (avec mise en sc√®ne).",
            "üì£ Lui faire cr√©er un slogan pour la soir√©e et le chanter une fois.",
            "ü•É Lui fait prendre un cul sec.",
            "üíÉ Danser avec elle.",
            "üí¨ Lui faire avouer quelque chose."
        ];

        // R√©f√©rences aux √©l√©ments du DOM
        const playerNameInput = document.getElementById('player-name-input');
        const addPlayerBtn = document.getElementById('add-player-btn');
        const playersList = document.getElementById('players-list');
        const startGameBtn = document.getElementById('start-game-btn');
        const resetGameBtn = document.getElementById('reset-game-btn');
        const addPlayersSection = document.getElementById('add-players-section');
        const gameSection = document.getElementById('game-section');
        const missionModal = document.getElementById('mission-modal');
        const playerTargetDisplay = document.getElementById('player-target');
        const playerMissionDisplay = document.getElementById('player-mission');
        const hideMissionBtn = document.getElementById('hide-mission-btn');
        const completeMissionBtn = document.getElementById('complete-mission-btn');
        const winModal = document.getElementById('win-modal');
        const winnerNameDisplay = document.getElementById('winner-name');
        const newGameBtn = document.getElementById('new-game-btn');
        const errorMessage = document.getElementById('error-message');
        const rulesContent = document.getElementById('rulesContent'); // Ajout de l'√©l√©ment des r√®gles
        const toggleRulesBtn = document.getElementById('toggleRulesBtn'); // Ajout du bouton bascule

        // Constantes et √©tat
        const LOCAL_STORAGE_KEY = 'assassin_game_state';
        let players = [];
        let gameStarted = false;
        let currentPlayerIndex = -1;

        /**
         * Sauvegarde l'√©tat du jeu dans le localStorage.
         */
        function saveGameState() {
            try {
                const gameState = { players, gameStarted };
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(gameState));
            } catch (e) {
                console.error("Erreur lors de la sauvegarde dans le localStorage", e);
            }
        }

        /**
         * Charge l'√©tat du jeu depuis le localStorage.
         */
        function loadGameState() {
            try {
                const storedState = localStorage.getItem(LOCAL_STORAGE_KEY);
                if (storedState) {
                    const gameState = JSON.parse(storedState);
                    players = gameState.players || [];
                    gameStarted = gameState.gameStarted || false;
                }
            } catch (e) {
                console.error("Erreur lors du chargement depuis le localStorage", e);
            }
        }

        /**
         * Met √† jour l'affichage de la liste des joueurs.
         */
        function renderPlayers() {
            playersList.innerHTML = '';
            if (players.length > 0) {
                gameSection.classList.remove('hidden');
            } else {
                gameSection.classList.add('hidden');
            }

            // Filtrer les joueurs pour n'afficher que ceux qui ne sont pas √©limin√©s
            const activePlayers = players.filter(player => !player.eliminated);
            
            activePlayers.forEach((player, index) => {
                const li = document.createElement('li');
                li.className = "flex justify-between items-center bg-slate-700 p-3 rounded-lg shadow-md";
                
                const playerNameSpan = document.createElement('span');
                playerNameSpan.textContent = player.name;
                li.appendChild(playerNameSpan);

                if (!gameStarted) {
                    const removeBtn = document.createElement('button');
                    removeBtn.textContent = '‚ùå';
                    removeBtn.className = "ml-4 p-1 rounded-full text-gray-400 hover:text-red-500 transition-colors";
                    removeBtn.addEventListener('click', () => removePlayer(index));
                    li.appendChild(removeBtn);
                } else {
                    li.classList.add('cursor-pointer', 'hover:bg-slate-600', 'transition-colors');
                    // Trouver l'index original du joueur dans le tableau complet pour le r√©v√©ler
                    const originalIndex = players.findIndex(p => p.name === player.name);
                    li.addEventListener('click', () => revealMission(originalIndex));
                }
                
                playersList.appendChild(li);
            });
        }

        /**
         * Ajoute un nouveau joueur.
         */
        function addPlayer() {
            const name = playerNameInput.value.trim();
            if (name && !players.find(p => p.name.toLowerCase() === name.toLowerCase())) {
                players.push({ name: name, target: null, mission: null, eliminated: false });
                playerNameInput.value = '';
                errorMessage.classList.add('hidden');
                renderPlayers();
                saveGameState();
            } else {
                errorMessage.classList.remove('hidden');
            }
        }

        /**
         * Supprime un joueur.
         * @param {number} index L'index du joueur √† supprimer.
         */
        function removePlayer(index) {
            players.splice(index, 1);
            renderPlayers();
            saveGameState();
        }

        /**
         * Distribue les cibles et les missions.
         */
        function assignMissions() {
            const activePlayers = players.filter(p => !p.eliminated);
            if (activePlayers.length < 2) {
                alert("Il faut au moins 2 joueurs pour commencer !");
                return;
            }

            const shuffledPlayers = [...activePlayers].sort(() => Math.random() - 0.5);
            const shuffledMissions = [...missions].sort(() => Math.random() - 0.5);

            for (let i = 0; i < shuffledPlayers.length; i++) {
                const current = shuffledPlayers[i];
                const target = shuffledPlayers[(i + 1) % shuffledPlayers.length];
                
                // Mettre √† jour l'objet joueur original
                const playerToUpdate = players.find(p => p.name === current.name);
                if (playerToUpdate) {
                    playerToUpdate.target = target.name;
                    playerToUpdate.mission = shuffledMissions[i % shuffledMissions.length];
                }
            }
            
            gameStarted = true;
            addPlayersSection.classList.add('hidden');
            startGameBtn.classList.add('hidden');
            renderPlayers();
            saveGameState();
        }

        /**
         * Affiche la mission et la cible d'un joueur dans une modale.
         * @param {number} index L'index du joueur.
         */
        function revealMission(index) {
            currentPlayerIndex = index;
            const player = players[currentPlayerIndex];

            playerTargetDisplay.textContent = player.target;
            playerMissionDisplay.textContent = player.mission;
            
            missionModal.classList.remove('hidden');
            completeMissionBtn.dataset.playerIndex = index;
        }

        /**
         * G√®re la compl√©tion d'une mission.
         */
        function completeMission() {
            const playerIndex = parseInt(completeMissionBtn.dataset.playerIndex, 10);
            const player = players[playerIndex];
            
            const eliminatedPlayer = players.find(p => p.name === player.target);
            if (eliminatedPlayer) {
                eliminatedPlayer.eliminated = true;
                
                // Le joueur qui vient de tuer prend la cible et la mission de sa victime
                player.target = eliminatedPlayer.target;
                player.mission = eliminatedPlayer.mission;
            }

            missionModal.classList.add('hidden');
            
            const remainingPlayers = players.filter(p => !p.eliminated);
            if (remainingPlayers.length === 1) {
                const winner = remainingPlayers[0];
                winnerNameDisplay.textContent = winner.name;
                winModal.classList.remove('hidden');
            } else {
                renderPlayers();
                saveGameState();
            }
        }
        
        /**
         * G√®re le bouton pour commencer la partie.
         */
        function handleGameStart() {
            if (players.length > 1) {
                assignMissions();
            } else {
                // Utilisation d'une modale ou d'un message visible au lieu d'alert()
                errorMessage.textContent = "Ajoutez au moins deux joueurs pour commencer.";
                errorMessage.classList.remove('hidden');
                setTimeout(() => errorMessage.classList.add('hidden'), 3000);
            }
        }
        
        /**
         * R√©initialise le jeu.
         */
        function resetGame() {
            localStorage.removeItem(LOCAL_STORAGE_KEY);
            window.location.reload();
        }

        // √âv√©nements
        addPlayerBtn.addEventListener('click', addPlayer);
        playerNameInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                addPlayer();
            }
        });
        startGameBtn.addEventListener('click', handleGameStart);
        resetGameBtn.addEventListener('click', resetGame);
        hideMissionBtn.addEventListener('click', () => {
            missionModal.classList.add('hidden');
        });
        completeMissionBtn.addEventListener('click', completeMission);
        newGameBtn.addEventListener('click', resetGame);

        // Toggle des r√®gles (ajout√©)
        toggleRulesBtn.addEventListener('click', () => {
            const isHidden = rulesContent.classList.toggle('hidden');
            toggleRulesBtn.textContent = isHidden ? 'Afficher les R√®gles du Jeu' : 'Masquer les R√®gles du Jeu';
        });

        // Initialisation
        window.onload = function() {
            loadGameState();
            if (gameStarted) {
                addPlayersSection.classList.add('hidden');
                gameSection.classList.remove('hidden');
                startGameBtn.classList.add('hidden');
            }
            renderPlayers();
        };
    </script>
</body>
</html>
